<!doctype html>
<!-- v1.3.7 -->
<html lang="en">
<head>
<meta charset="utf-8">

<style>
body {
  font-family: serif;
  padding: 24px;
}

/* ---------- Pills ---------- */
.pill-group {
  display: inline-flex;
  border: 1px solid black;
  border-radius: 999px;
  overflow: hidden;
  margin: 6px 0;
}

.pill {
  padding: 6px 14px;
  background: white;
  color: black;
  border: none;
  border-right: 1px solid black;
  cursor: pointer;
  user-select: none;
}

.pill:last-child { border-right: none; }
.pill.active { background: black; color: white; }

/* ---------- Roll button ---------- */
#dicebtn {
  margin-top: 16px;
  padding: 12px 28px;
  font-size: 18px;
  border: 2px solid black;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}
#dicebtn:active { transform: translateY(1px); }

/* ---------- Output ---------- */
#output {
  margin-top: 24px;
  display: flex;
  gap: 32px;
  align-items: flex-start;
}

.die-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 12px;
}

/* Die SVG */
.die {
  width: 80px;
  height: 80px;
}

/* Shapes coloring */
.die rect, .die polygon, .die path {
  stroke: black;
  stroke-width: 2;
  fill: white;
}

/* Nat1 / Nat20 */
.die.nat1 polygon, .die.nat1 path { fill: #ff4d4d; }
.die.nat20 polygon, .die.nat20 path { fill: gold; }

/* Winner highlight */
.winner.adv polygon, .winner.adv path, .winner.adv rect {
  stroke: green;
  filter: drop-shadow(0 0 6px rgba(0,128,0,.6));
}
.winner.dis polygon, .winner.dis path, .winner.dis rect {
  stroke: red;
  filter: drop-shadow(0 0 6px rgba(128,0,0,.6));
}

/* Text inside die */
.die text {
  font-size: 28px;
  dominant-baseline: middle;
  text-anchor: middle;
  fill: black;
  font-weight: bold;
}

/* Modifier + Total side panel */
.mod-total-container {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.mod-total {
  font-size: 16px;
}

/* Roll flash animation */
@keyframes rollFlash {
  0% { background: transparent; }
  50% { background: #f0f0f0; }
  100% { background: transparent; }
}
#output.rolling { animation: rollFlash 300ms ease; }
</style>
</head>

<body>

<!-- Dice (exclusive, required) -->
<div class="pill-group" id="dice-group">
  <button type="button" class="pill" data-dice="4">d4</button>
  <button type="button" class="pill" data-dice="6">d6</button>
  <button type="button" class="pill" data-dice="8">d8</button>
  <button type="button" class="pill" data-dice="10">d10</button>
  <button type="button" class="pill" data-dice="12">d12</button>
  <button type="button" class="pill active" data-dice="20">d20</button>
</div>

<br>

<!-- Modifier (exclusive, optional) -->
<div class="pill-group" id="mod-group">
  <button type="button" class="pill" data-mod="str">STR</button>
  <button type="button" class="pill" data-mod="int">INT</button>
  <button type="button" class="pill" data-mod="dex">DEX</button>
  <button type="button" class="pill" data-mod="wis">WIS</button>
  <button type="button" class="pill" data-mod="con">CON</button>
  <button type="button" class="pill" data-mod="cha">CHA</button>
</div>

<br>

<!-- Advantage (exclusive, optional) -->
<div class="pill-group" id="adv-group">
  <button type="button" class="pill" data-adv="adv">Advantage</button>
  <button type="button" class="pill" data-adv="dis">Disadvantage</button>
</div>

<br>

<button type="button" id="dicebtn">Roll</button>

<div id="output"></div>

<script>
const output = document.getElementById("output");
const mods = { str: -1, int: 0, dex: 2, wis: 1, con: 0, cha: -2 };

/* Dice buttons: exclusive */
document.querySelectorAll("#dice-group .pill").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll("#dice-group .pill").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
});

/* Toggle groups (exclusive + deselectable) */
function setupToggleGroup(groupId) {
  document.querySelectorAll(`#${groupId} .pill`).forEach(btn => {
    btn.addEventListener("click", () => {
      const wasActive = btn.classList.contains("active");
      document.querySelectorAll(`#${groupId} .pill`).forEach(b => b.classList.remove("active"));
      if (!wasActive) btn.classList.add("active");
    });
  });
}
setupToggleGroup("mod-group");
setupToggleGroup("adv-group");

document.getElementById("dicebtn").addEventListener("click", roll);

function roll() {
  const diceBtn = document.querySelector("#dice-group .pill.active");
  if (!diceBtn) return;

  const diceValue = Number(diceBtn.dataset.dice);
  const modBtn = document.querySelector("#mod-group .pill.active");
  const advBtn = document.querySelector("#adv-group .pill.active");

  const modKey = modBtn ? modBtn.dataset.mod : null;
  const advValue = advBtn ? advBtn.dataset.adv : "NONE";

  const d1 = rollDie(diceValue, modKey);
  let d2 = null;
  if (advValue !== "NONE") d2 = rollDie(diceValue, modKey);

  // Trigger roll animation even if numbers are same
  output.classList.remove("rolling");
  void output.offsetWidth;
  output.classList.add("rolling");

  output.innerHTML = renderDice(d1, d2, advValue, diceValue);
}

function rollDie(dice, modKey) {
  const roll = Math.floor(Math.random() * dice) + 1;
  let nat1 = false, nat20 = false, total = roll;
  let modValue = 0;

  if (dice === 20) {
    if (roll === 1) nat1 = true;
    else if (roll === 20) nat20 = true;
  }

  if (!nat1 && !nat20 && modKey) {
    modValue = mods[modKey];
    total += modValue;
  }

  return { roll, mod: modValue, total, nat1, nat20 };
}

function renderDice(d1, d2, adv, diceValue) {
  if (!d2) return renderSingleDie(d1, diceValue, true);

  let winnerIdx;
  if (adv === "adv") winnerIdx = d1.total >= d2.total ? 0 : 1;
  else winnerIdx = d1.total <= d2.total ? 0 : 1;
  if (d1.total === d2.total) winnerIdx = 0;

  return [d1,d2].map((d, idx) => renderSingleDie(d, diceValue, idx === winnerIdx, idx === winnerIdx ? adv : "")).join('');
}

function renderSingleDie(d, diceValue, showModTotal, adv = "") {
  let cls = "normal";
  if (diceValue === 20) {
    if (d.nat1) cls += " nat1";
    if (d.nat20) cls += " nat20";
  }
  if (adv) cls += ` winner ${adv}`;

  let shapeSvg = '';
  switch(diceValue) {
    case 4: // triangle
      shapeSvg = `<polygon points="50,10 90,85 10,85"/>`; break;
    case 6: // square
      shapeSvg = `<rect x="10" y="10" width="80" height="80"/>`; break;
    case 8: // diamond
      shapeSvg = `<polygon points="50,0 90,50 50,100 10,50"/>
                  <polygon points="50,0 90,50 10,50" fill="#f0f0f0"/>`; break;
    case 10: // pentagon
      shapeSvg = `<polygon points="50,10 90,40 73,90 27,90 10,40"/>`; break;
    case 12: // hexagon
      shapeSvg = `<polygon points="30,10 70,10 90,50 70,90 30,90 10,50"/>`; break;
    case 20: // approximated icosahedron
      shapeSvg = `<polygon points="50,10 80,25 90,50 80,75 50,90 20,75 10,50 20,25"/>`; break;
  }

  return `
    <div class="die-container">
      <svg class="die ${cls}" viewBox="0 0 100 100">${shapeSvg}
        <text x="50" y="55">${d.roll}</text>
      </svg>
      ${showModTotal ? `
      <div class="mod-total-container">
        ${d.mod !== 0 ? `<div class="mod-total">Modifier: ${d.mod > 0 ? "+" : ""}${d.mod}</div>` : ''}
        <div class="mod-total">Total: ${d.total}</div>
      </div>` : ''}
    </div>
  `;
}
</script>

</body>
</html>
