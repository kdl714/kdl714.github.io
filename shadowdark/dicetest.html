<!doctype html>
<!-- v1.3.2 -->
<html lang="en">
<head>
<meta charset="utf-8">

<style>
body {
  font-family: serif;
  padding: 24px;
}

/* ---------- Pills ---------- */
.pill-group {
  display: inline-flex;
  border: 1px solid black;
  border-radius: 999px;
  overflow: hidden;
  margin: 6px 0;
}

.pill {
  padding: 6px 14px;
  background: white;
  color: black;
  border: none;
  border-right: 1px solid black;
  cursor: pointer;
  user-select: none;
}

.pill:last-child { border-right: none; }
.pill.active { background: black; color: white; }

/* ---------- Roll button ---------- */
#dicebtn {
  margin-top: 16px;
  padding: 12px 28px;
  font-size: 18px;
  border: 2px solid black;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}
#dicebtn:active { transform: translateY(1px); }

/* ---------- Output ---------- */
#output {
  margin-top: 24px;
  display: flex;
  gap: 24px;
  align-items: flex-start;
}

.die-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.die {
  width: 80px;
  height: 80px;
}

.die rect {
  stroke: black;
  stroke-width: 2;
  rx: 12;
  fill: white;
}

/* Nat1 / Nat20 */
.die.nat1 rect { fill: #ff4d4d; }
.die.nat20 rect { fill: gold; }

/* Winner highlight */
.winner.adv rect {
  stroke: green;
  filter: drop-shadow(0 0 6px rgba(0,128,0,.6));
}
.winner.dis rect {
  stroke: red;
  filter: drop-shadow(0 0 6px rgba(128,0,0,.6));
}

/* Text inside die */
.die text {
  font-size: 28px;
  dominant-baseline: middle;
  text-anchor: middle;
  fill: black;
  font-weight: bold;
}

/* Mod + Total display */
.mod-total {
  margin-top: 4px;
  font-size: 16px;
  text-align: center;
}
</style>
</head>

<body>

<!-- Dice (exclusive, required) -->
<div class="pill-group" id="dice-group">
  <button type="button" class="pill" data-dice="4">d4</button>
  <button type="button" class="pill" data-dice="6">d6</button>
  <button type="button" class="pill" data-dice="8">d8</button>
  <button type="button" class="pill" data-dice="10">d10</button>
  <button type="button" class="pill" data-dice="12">d12</button>
  <button type="button" class="pill active" data-dice="20">d20</button>
</div>

<br>

<!-- Modifier (exclusive, optional) -->
<div class="pill-group" id="mod-group">
  <button type="button" class="pill" data-mod="str">STR</button>
  <button type="button" class="pill" data-mod="int">INT</button>
  <button type="button" class="pill" data-mod="dex">DEX</button>
  <button type="button" class="pill" data-mod="wis">WIS</button>
  <button type="button" class="pill" data-mod="con">CON</button>
  <button type="button" class="pill" data-mod="cha">CHA</button>
</div>

<br>

<!-- Advantage (exclusive, optional) -->
<div class="pill-group" id="adv-group">
  <button type="button" class="pill" data-adv="adv">Advantage</button>
  <button type="button" class="pill" data-adv="dis">Disadvantage</button>
</div>

<br>

<button type="button" id="dicebtn">Roll</button>

<div id="output"></div>

<script>
const output = document.getElementById("output");
const mods = { str: -1, int: 0, dex: 2, wis: 1, con: 0, cha: -2 };

/* Dice buttons: exclusive */
document.querySelectorAll("#dice-group .pill").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll("#dice-group .pill").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
});

/* Toggle groups (exclusive + deselectable) */
function setupToggleGroup(groupId) {
  document.querySelectorAll(`#${groupId} .pill`).forEach(btn => {
    btn.addEventListener("click", () => {
      const wasActive = btn.classList.contains("active");
      document.querySelectorAll(`#${groupId} .pill`).forEach(b => b.classList.remove("active"));
      if (!wasActive) btn.classList.add("active");
    });
  });
}
setupToggleGroup("mod-group");
setupToggleGroup("adv-group");

document.getElementById("dicebtn").addEventListener("click", roll);

function roll() {
  const diceBtn = document.querySelector("#dice-group .pill.active");
  if (!diceBtn) return;

  const diceValue = Number(diceBtn.dataset.dice);
  const modBtn = document.querySelector("#mod-group .pill.active");
  const advBtn = document.querySelector("#adv-group .pill.active");

  const modKey = modBtn ? modBtn.dataset.mod : null;
  const advValue = advBtn ? advBtn.dataset.adv : "NONE";

  const d1 = rollDie(diceValue, modKey);
  const d2 = rollDie(diceValue, modKey);

  output.innerHTML = renderDice(d1, d2, advValue, diceValue);
}

function rollDie(dice, modKey) {
  const roll = Math.floor(Math.random() * dice) + 1;
  let nat1 = false, nat20 = false, total = roll;
  let modValue = 0;

  if (dice === 20) {
    if (roll === 1) nat1 = true;
    else if (roll === 20) nat20 = true;
  }

  if (!nat1 && !nat20 && modKey) {
    modValue = mods[modKey];
    total += modValue;
  }

  return { roll, mod: modValue, total, nat1, nat20 };
}

function renderDice(d1, d2, adv, diceValue) {
  let diceArray = [d1, d2];
  let winnerIdx = null;

  if (adv !== "NONE") {
    if (adv === "adv") winnerIdx = d1.total >= d2.total ? 0 : 1;
    else winnerIdx = d1.total <= d2.total ? 0 : 1; // disadvantage picks lower
  }

  return diceArray.map((d, idx) => {
    let cls = "normal";
    if (diceValue === 20) {
      if (d.nat1) cls += " nat1";
      if (d.nat20) cls += " nat20";
    }
    if (winnerIdx === idx) cls += ` winner ${adv}`;

    return `
      <div class="die-container">
        <svg class="die ${cls}" viewBox="0 0 100 100">
          <rect x="10" y="10" width="80" height="80"></rect>
          <text x="50" y="55" font-size="28" text-anchor="middle" dominant-baseline="middle">${d.roll}</text>
        </svg>
        ${d.mod !== 0 ? `<div class="mod-total">Modifier: ${d.mod > 0 ? "+" : ""}${d.mod}</div>` : ''}
        ${d.mod !== 0 ? `<div class="mod-total">Total: ${d.total}</div>` : ''}
      </div>
    `;
  }).join('');
}
</script>

</body>
</html>
