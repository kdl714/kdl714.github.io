<!doctype html>
<!-- v1.3.8.6 -->
<html lang="en">
<head>
<meta charset="utf-8">

<style>
body {
  font-family: serif;
  padding: 24px;
}

/* ---------- Pills ---------- */
.pill-group {
  display: inline-flex;
  border: 1px solid black;
  border-radius: 999px;
  overflow: hidden;
  margin: 6px 0;
}

.pill {
  padding: 6px 14px;
  background: white;
  color: black;
  border: none;
  border-right: 1px solid black;
  cursor: pointer;
}

.pill:last-child { border-right: none; }
.pill.active { background: black; color: white; }

/* ---------- Roll button ---------- */
#dicebtn {
  margin-top: 16px;
  padding: 12px 28px;
  font-size: 18px;
  border: 2px solid black;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}

/* ---------- Output ---------- */
#output {
  margin-top: 24px;
  display: flex;
  gap: 32px;
  align-items: center;
}

.die-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

.die {
  width: 90px;
  height: 90px;
}

.die polygon,
.die rect {
  fill: white;
  stroke: black;
  stroke-width: 2;
}

/* Winner highlight */
.winner.adv polygon,
.winner.adv rect {
  stroke: green;
  filter: drop-shadow(0 0 6px rgba(0,128,0,.6));
}

.winner.dis polygon,
.winner.dis rect {
  stroke: red;
  filter: drop-shadow(0 0 6px rgba(128,0,0,.6));
}

/* Nat 1 / 20 */
.nat1 polygon,
.nat1 rect { fill: #ffcccc; }

.nat20 polygon,
.nat20 rect { fill: gold; }

.die text {
  font-size: 20px;
  font-weight: bold;
  text-anchor: middle;
  dominant-baseline: middle;
}

.mod-total {
  font-size: 16px;
}

/* Roll flash */
@keyframes flash {
  0% { background: transparent; }
  50% { background: #f2f2f2; }
  100% { background: transparent; }
}
#output.rolling { animation: flash .3s ease; }
</style>
</head>

<body>

<div class="pill-group" id="dice-group">
  <button class="pill" data-dice="4">d4</button>
  <button class="pill" data-dice="6">d6</button>
  <button class="pill" data-dice="8">d8</button>
  <button class="pill" data-dice="10">d10</button>
  <button class="pill" data-dice="12">d12</button>
  <button class="pill active" data-dice="20">d20</button>
</div>

<br>

<div class="pill-group" id="mod-group">
  <button class="pill" data-mod="str">STR</button>
  <button class="pill" data-mod="int">INT</button>
  <button class="pill" data-mod="dex">DEX</button>
  <button class="pill" data-mod="wis">WIS</button>
  <button class="pill" data-mod="con">CON</button>
  <button class="pill" data-mod="cha">CHA</button>
</div>

<br>

<div class="pill-group" id="adv-group">
  <button class="pill" data-adv="adv">Advantage</button>
  <button class="pill" data-adv="dis">Disadvantage</button>
</div>

<br>

<button id="dicebtn">Roll</button>

<div id="output"></div>

<script>
const mods = { str:-1, int:0, dex:2, wis:1, con:0, cha:-2 };
const output = document.getElementById("output");

/* Pill behavior */
function exclusive(group) {
  document.querySelectorAll(group + " .pill").forEach(b => {
    b.onclick = () => {
      document.querySelectorAll(group + " .pill").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
    };
  });
}
function toggle(group) {
  document.querySelectorAll(group + " .pill").forEach(b => {
    b.onclick = () => {
      const on = b.classList.contains("active");
      document.querySelectorAll(group + " .pill").forEach(x => x.classList.remove("active"));
      if (!on) b.classList.add("active");
    };
  });
}

exclusive("#dice-group");
toggle("#mod-group");
toggle("#adv-group");

document.getElementById("dicebtn").onclick = roll;

function rollDie(d, modKey) {
  const roll = Math.floor(Math.random() * d) + 1;
  let total = roll;
  let mod = 0;
  let nat1 = false, nat20 = false;

  if (d === 20) {
    if (roll === 1) nat1 = true;
    if (roll === 20) nat20 = true;
  }

  if (!nat1 && !nat20 && modKey) {
    mod = mods[modKey];
    total += mod;
  }

  return { roll, total, mod, nat1, nat20 };
}

function roll() {
  const dice = +document.querySelector("#dice-group .active").dataset.dice;
  const modBtn = document.querySelector("#mod-group .active");
  const advBtn = document.querySelector("#adv-group .active");

  const modKey = modBtn ? modBtn.dataset.mod : null;
  const adv = advBtn ? advBtn.dataset.adv : "NONE";

  const d1 = rollDie(dice, modKey);
  const d2 = adv !== "NONE" ? rollDie(dice, modKey) : null;

  output.classList.remove("rolling");
  void output.offsetWidth;
  output.classList.add("rolling");

  output.innerHTML = render(d1, d2, adv, dice);
}

function render(d1, d2, adv, dice) {
  if (!d2) return dieHTML(d1, dice, true);

  let win = d1.total === d2.total ? d1 :
            adv === "adv" ? (d1.total > d2.total ? d1 : d2)
                          : (d1.total < d2.total ? d1 : d2);

  return dieHTML(d1, dice, d1 === win, adv) +
         dieHTML(d2, dice, d2 === win, adv);
}

function dieHTML(d, dice, show, adv="") {
  let cls = "";
  if (adv && show) cls = `winner ${adv}`;
  if (d.nat1) cls += " nat1";
  if (d.nat20) cls += " nat20";

  return `
  <div class="die-container">
    <svg class="die ${cls}" viewBox="0 0 120 100">
      ${dieShape(dice, d.roll)}
    </svg>
    ${show ? `
      <div>
        ${d.mod ? `<div class="mod-total">Mod: ${d.mod > 0 ? "+" : ""}${d.mod}</div>` : ""}
        <div class="mod-total">Total: ${d.total}</div>
      </div>` : ""}
  </div>`;
}

function dieShape(d, n) {
  if (d === 10) {
    return `
      <!-- top face -->
      <polygon points="40,10 80,10 100,30 20,30"/>
      <!-- left face -->
      <polygon points="20,30 40,10 40,70 20,90"/>
      <!-- right face -->
      <polygon points="80,10 100,30 100,90 80,70"/>
      <!-- bottom face -->
      <polygon points="40,70 80,70 100,90 20,90"/>

      <!-- top hash -->
      <line x1="60" y1="14" x2="60" y2="26" stroke="black" stroke-width="1.5"/>
      <line x1="50" y1="20" x2="70" y2="20" stroke="black" stroke-width="1.5"/>

      <text x="60" y="22">${n}</text>
    `;
  }

  if (d === 4) return `<polygon points="60,10 110,90 10,90"/><text x="60" y="65">${n}</text>`;
  if (d === 6) return `<rect x="20" y="20" width="80" height="80"/><text x="60" y="60">${n}</text>`;
  if (d === 8) return `<polygon points="60,5 110,50 60,95 10,50"/><text x="60" y="38">${n}</text>`;
  if (d === 12) return `<polygon points="40,10 80,10 110,50 80,90 40,90 10,50"/><text x="60" y="60">${n}</text>`;
  return `<polygon points="60,10 95,25 110,50 95,75 60,90 25,75 10,50 25,25"/><text x="60" y="60">${n}</text>`;
}
</script>

</body>
</html>
