<!doctype html>
<!-- 1.4 -->
<html lang="en">
<head>
<meta charset="utf-8">

<style>
body {
  font-family: serif;
  padding: 24px;
}

/* ---------- Pills ---------- */
.pill-group {
  display: inline-flex;
  border: 1px solid black;
  border-radius: 999px;
  overflow: hidden;
  margin: 6px 0;
}

.pill {
  padding: 6px 14px;
  background: white;
  color: black;
  border: none;
  border-right: 1px solid black;
  cursor: pointer;
}

.pill:last-child { border-right: none; }
.pill.active { background: black; color: white; }

/* ---------- Roll button ---------- */
#dicebtn {
  margin-top: 16px;
  padding: 12px 28px;
  font-size: 18px;
  border: 2px solid black;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}

/* ---------- Output ---------- */
#output {
  margin-top: 24px;
  display: flex;
  gap: 32px;
  align-items: center;
}

.die-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

.die {
  width: 90px;
  height: 90px;
  color: black; /* outline + number inherit color */
}

.die line,
.die polygon,
.die rect {
  stroke: currentColor;
  stroke-width: 2;
  fill: white;
}

.die text {
  font-size: 20px;
  font-weight: bold;
  text-anchor: middle;
  dominant-baseline: middle;
  fill: currentColor;
  filter: drop-shadow(0 0 2px rgba(0,0,0,0.2));
}

/* Winner highlight (outline + number) */
.winner.adv {
  color: green;
  filter: drop-shadow(0 0 6px rgba(0,128,0,.6));
}
.winner.adv text {
  filter: drop-shadow(0 0 4px rgba(0,255,0,0.6));
}

.winner.dis {
  color: red;
  filter: drop-shadow(0 0 6px rgba(128,0,0,.6));
}
.winner.dis text {
  filter: drop-shadow(0 0 4px rgba(255,0,0,0.6));
}

/* Nat 1 / 20 highlight */
.nat1 { color: #8b0000; }
.nat1 text { filter: drop-shadow(0 0 4px #8b0000); }

.nat20 { color: gold; }
.nat20 text { filter: drop-shadow(0 0 4px gold); }

.mod-total {
  font-size: 16px;
}

/* Roll flash */
@keyframes flash {
  0% { background: transparent; }
  50% { background: #f2f2f2; }
  100% { background: transparent; }
}
#output.rolling { animation: flash .3s ease; }
</style>
</head>

<body>

<div class="pill-group" id="dice-group">
  <button class="pill" data-dice="4">d4</button>
  <button class="pill" data-dice="6">d6</button>
  <button class="pill" data-dice="8">d8</button>
  <button class="pill" data-dice="10">d10</button>
  <button class="pill" data-dice="12">d12</button>
  <button class="pill active" data-dice="20">d20</button>
</div>

<br>

<div class="pill-group" id="mod-group">
  <button class="pill" data-mod="str">STR</button>
  <button class="pill" data-mod="int">INT</button>
  <button class="pill" data-mod="dex">DEX</button>
  <button class="pill" data-mod="wis">WIS</button>
  <button class="pill" data-mod="con">CON</button>
  <button class="pill" data-mod="cha">CHA</button>
</div>

<br>

<div class="pill-group" id="adv-group">
  <button class="pill" data-adv="adv">Advantage</button>
  <button class="pill" data-adv="dis">Disadvantage</button>
</div>

<br>

<button id="dicebtn">Roll</button>

<div id="output"></div>

<script>
const mods = { str:-1, int:0, dex:2, wis:1, con:0, cha:-2 };
const output = document.getElementById("output");

/* Pill behavior */
function exclusive(group) {
  document.querySelectorAll(group + " .pill").forEach(b => {
    b.onclick = () => {
      document.querySelectorAll(group + " .pill").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
    };
  });
}
function toggle(group) {
  document.querySelectorAll(group + " .pill").forEach(b => {
    b.onclick = () => {
      const on = b.classList.contains("active");
      document.querySelectorAll(group + " .pill").forEach(x => x.classList.remove("active"));
      if (!on) b.classList.add("active");
    };
  });
}

exclusive("#dice-group");
toggle("#mod-group");
toggle("#adv-group");

document.getElementById("dicebtn").onclick = roll;

function rollDie(d, modKey) {
  const roll = Math.floor(Math.random() * d) + 1;
  let total = roll;
  let mod = 0;
  let nat1 = false, nat20 = false;

  if (d === 20) {
    if (roll === 1) nat1 = true;
    if (roll === 20) nat20 = true;
  }

  if (!nat1 && !nat20 && modKey) {
    mod = mods[modKey];
    total += mod;
  }

  return { roll, total, mod, nat1, nat20 };
}

function roll() {
  const dice = +document.querySelector("#dice-group .active").dataset.dice;
  const modBtn = document.querySelector("#mod-group .active");
  const advBtn = document.querySelector("#adv-group .active");

  const modKey = modBtn ? modBtn.dataset.mod : null;
  const adv = advBtn ? advBtn.dataset.adv : "NONE";

  const d1 = rollDie(dice, modKey);
  const d2 = adv !== "NONE" ? rollDie(dice, modKey) : null;

  output.classList.remove("rolling");
  void output.offsetWidth;
  output.classList.add("rolling");

  output.innerHTML = render(d1, d2, adv, dice);
}

function render(d1, d2, adv, dice) {
  if (!d2) return dieHTML(d1, dice, true);

  let win = d1.total === d2.total ? d1 :
            adv === "adv" ? (d1.total > d2.total ? d1 : d2)
                          : (d1.total < d2.total ? d1 : d2);

  return dieHTML(d1, dice, d1 === win, adv) +
         dieHTML(d2, dice, d2 === win, adv);
}

function dieHTML(d, dice, show, adv="") {
  let cls = "";
  if (adv && show) cls = `winner ${adv}`;
  if (d.nat1) cls += " nat1";
  if (d.nat20) cls += " nat20";

  return `
  <div class="die-container">
    <svg class="die ${cls}" viewBox="0 0 120 100">
      ${dieShape(dice, d.roll)}
    </svg>
    ${show ? `
      <div>
        ${d.mod ? `<div class="mod-total">Mod: ${d.mod > 0 ? "+" : ""}${d.mod}</div>` : ""}
        <div class="mod-total">Total: ${d.total}</div>
      </div>` : ""}
  </div>`;
}

function dieShape(d, n) {
  if (d === 4) return `
    <g>
      <line id="AB" x1="85" y1="5" x2="45" y2="35"/>
      <line id="AD" y1="5" x1="5" x2="45" y2="35"/>
      <line id="BC" x1="85" y1="35" x2="45" y2="95"/>
      <line id="CD" x1="5" y1="35" x2="45" y2="95"/>
      <line id="AC" x1="45" y1="5" x2="45" y2="95"/>
      <text x="45" y="40"> ${n} </text>
    </g>`;

  if (d === 6) return `
    <g>
      <line y1="10" y2="10" x1="20" x2="70"/>
      <line y1="10" y2="60" x1="70" x2="70"/>
      <line y1="60" y2="60" x1="70" x2="20"/>
      <line y1="10" y2="60" x1="20" x2="20"/>
      <line x1="20" y1="10" x2="10" y2="25"/>
      <line x1="10" y1="25" x2="10" y2="75"/>
      <line x1="10" y1="75" x2="20" y2="60"/>
      <line x1="10" y1="75" x2="55" y2="75"/>
      <line x1="70" y1="60" x2="55" y2="75"/>
      <text x="45" y="35"> ${n} </text>
    </g>`;

  if (d === 8) return `
    <g>
      <line y1="65" y2="5" x1="83" x2="45"/>
      <line y1="30" y2="5" x1="85" x2="45"/>
      <line x1="85" y1="30" x2="83" y2="65"/>
      <line y1="65" y2="5" x1="7" x2="45"/>
      <line y1="30" y2="5" x1="5" x2="45"/>
      <line y1="65" y2="65" x1="83" x2="7"/>
      <line x1="45" y1="95" x2="7" y2="65"/>
      <line x1="45" y1="95" x2="83" y2="65"/>
      <text x="45" y="45"> ${n} </text>
    </g>`;

  if (d === 10) return `
    <g>
      <line y1="55" y2="5" x1="105" x2="55"/>
      <line y1="55" y2="5" x1="5" x2="55"/>
      <line x1="55" y1="105" x2="5" y2="55"/>
      <line x1="105" y1="105" x2="55" y2="55"/>
      <line x1="55" y1="55" x2="55" y2="5"/>
      <line x1="55" y1="55" x2="80" y2="60"/>
      <line x1="100" y1="50" x2="80" y2="60"/>
      <line x1="55" y1="105" x2="80" y2="60"/>
      <line x1="55" y1="55" x2="30" y2="60"/>
      <line x1="10" y1="50" x2="30" y2="60"/>
      <line x1="55" y1="105" x2="30" y2="60"/>
      <text x="69" y="39"> ${n} </text>
    </g>`;

  if (d === 12) return `
    <g>
      <line x1="50" y1="5" x2="76.45" y2="13.59"/>
      <line x1="76.45" y1="13.59" x2="92.8" y2="36.1"/>
      <line x1="92.8" y1="36.1" x2="92.8" y2="63.9"/>
      <line x1="76.45" y1="86.41" x2="92.8" y2="63.9"/>
      <line x1="76.45" y1="86.41" x2="50" y2="95"/>
      <line x1="23.55" y1="86.41" x2="50" y2="95"/>
      <line x1="7.2" y1="63.9" x2="23.55" y2="86.41"/>
      <line x1="7.2" y1="36.1" x2="7.2" y2="63.9"/>
      <line x1="23.55" y1="13.59" x2="7.2" y2="36.1"/>
      <line x1="50" y1="5" x2="23.55" y2="13.59"/>
      <text x="50" y="52"> ${n} </text>
    </g>`;

  // fallback for d20
  return `
    <g>
      <line x1="50" y1="5" x2="88.97" y2="27.5"/>
      <line x1="88.97" y1="27.5" x2="88.97" y2="72.5"/>
      <line x1="88.97" y1="72.5" x2="50" y2="95"/>
      <line x1="50" y1="95" x2="11.03" y2="72.5"/>
      <line x1="11.03" y1="72.5" x2="11.03" y2="27.5"/>
      <line x1="11.03" y1="27.5" x2="50" y2="5"/>
      <text x="50" y="50"> ${n} </text>
    </g>`;
}
</script>

</body>
</html>
