<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">

  <style>
    body {
      font-family: serif;
      background: #fff;
      padding: 24px;
      color: #000;
    }

    h1 {
      font-size: 42px;
      margin: 0 0 12px 0;
    }

    .sheet {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 16px;
      max-width: 1200px;
    }

    .box {
      border: 2px solid #000;
      padding: 6px;
    }

    .title {
      font-weight: bold;
      border-bottom: 1px solid #000;
      margin-bottom: 4px;
    }

    .left {
      display: grid;
      grid-template-rows: auto auto auto auto 1fr;
      gap: 8px;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
    }

    .stat {
      border: 2px solid #000;
      padding: 4px;
      font-weight: bold;
    }

    .combat {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
    }

    .right {
      display: grid;
      grid-template-rows: 180px 1fr;
      gap: 8px;
    }

    textarea {
      width: 100%;
      height: 100px;
      border: none;
      resize: none;
      font-family: inherit;
    }

    input {
      border: none;
      width: 100%;
      background: transparent;
      font-family: inherit;
    }
  </style>
</head>

<body>

<div>
  <label>Character</label>
  <select id="characterSelect"></select>
</div>

<div id="sheet" class="sheet"></div>

<script>
function mod(v) { return Math.floor((v - 10) / 2); }

google.script.run
  .withSuccessHandler(chars => {
    const sel = document.getElementById('characterSelect');
    sel.innerHTML = '<option>Selectâ€¦</option>';

    chars.forEach(c => {
      const o = document.createElement('option');
      o.value = c.id;
      o.textContent = c.name;
      sel.appendChild(o);
    });

    sel.onchange = () =>
      google.script.run
        .withSuccessHandler(render)
        .getCharacterById(sel.value);
  })
  .getAllCharacters();

function render(c) {
  document.getElementById('sheet').innerHTML = `
    <div class="left">
      <h1>Shadowdark</h1>

      <div class="box">
        <div class="title">NAME</div>
        <input value="${c.NAME || ''}">
      </div>

      <div class="stats">
        ${['STR','DEX','CON','INT','WIS','CHA'].map(s => `
          <div class="stat">
            ${s}
            <input type="number" value="${c[s]}" 
              onchange="this.nextElementSibling.textContent = mod(this.value)">
            <span>${mod(c[s]) >= 0 ? '+' : ''}${mod(c[s])}</span>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}
</script>

</body>
</html>
